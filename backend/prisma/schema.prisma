// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String?
  name          String?
  userType      String    @default("client") // "client" or "producer"
  oauthProvider String?   // "google", "facebook", "pinterest"
  oauthId       String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  bodyMeasurements BodyMeasurement?
  orders        Order[]
  products      Product[] // Relacja do produktów dla producentów
  // Nowe relacje dla właściwości produktu zarządzanych przez producenta
  productStyles ProductStyle[]
  productMaterials ProductMaterial[]
  productFinishes ProductFinish[]
}

model BodyMeasurement {
  id            String    @id @default(uuid())
  userId        String    @unique
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  height        Float
  chest         Float
  waist         Float
  hips          Float
  shoulders     Float
  inseam        Float?
  bodyType      String?   // "hourglass", "pear", "rectangle", "inverted triangle", "apple"
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Product {
  id            String    @id @default(uuid())
  sellerId      String
  seller        User      @relation(fields: [sellerId], references: [id])
  name          String
  description   String?
  basePrice     Float
  category      String    // "jacket", "pants", "skirt", "vest"
  // Usuwamy bezpośrednie relacje do właściwości - teraz będą zarządzane przez warianty
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  orderItems    OrderItem[]
  variants      ProductVariant[]
}

// Nowy model dla właściwości stylu zarządzanych przez producenta
model ProductStyle {
  id            String    @id @default(uuid())
  producerId    String
  producer      User      @relation(fields: [producerId], references: [id], onDelete: Cascade)
  name          String
  description   String?
  imageUrl      String?   // Obrazek dla właściwości stylu
  additionalPrice Float    @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  variants      ProductVariant[]
  orderItems    OrderItem[]
}

// Nowy model dla właściwości materiału zarządzanych przez producenta
model ProductMaterial {
  id            String    @id @default(uuid())
  producerId    String
  producer      User      @relation(fields: [producerId], references: [id], onDelete: Cascade)
  name          String
  description   String?
  imageUrl      String?   // Obrazek dla właściwości materiału
  additionalPrice Float    @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  variants      ProductVariant[]
  orderItems    OrderItem[]
}

// Nowy model dla właściwości wykończenia zarządzanych przez producenta
model ProductFinish {
  id            String    @id @default(uuid())
  producerId    String
  producer      User      @relation(fields: [producerId], references: [id], onDelete: Cascade)
  name          String
  description   String?
  imageUrl      String?   // Obrazek dla właściwości wykończenia
  additionalPrice Float    @default(0)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  variants      ProductVariant[]
  orderItems    OrderItem[]
}

// Nowy model dla wariantów produktu
model ProductVariant {
  id            String    @id @default(uuid())
  productId     String
  product       Product   @relation(fields: [productId], references: [id], onDelete: Cascade)
  styleId       String?
  style         ProductStyle? @relation(fields: [styleId], references: [id])
  materialId    String?
  material      ProductMaterial? @relation(fields: [materialId], references: [id])
  finishId      String?
  finish        ProductFinish? @relation(fields: [finishId], references: [id])
  sku           String?   // Unikalny kod wariantu
  price         Float     // Obliczona cena wariantu (basePrice + dodatki)
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  images        ProductVariantImage[]
  orderItems    OrderItem[]
  
  @@unique([productId, styleId, materialId, finishId])
}

// Nowy model dla obrazków wariantów produktu
model ProductVariantImage {
  id            String    @id @default(uuid())
  variantId     String
  variant       ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)
  imageUrl      String
  viewType      String    // "front", "left", "right"
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@unique([variantId, viewType])
}

model Order {
  id            String    @id @default(uuid())
  userId        String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  status        String    // "draft", "submitted", "processing", "completed", "cancelled"
  totalPrice    Float
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  items         OrderItem[]
}

model OrderItem {
  id            String    @id @default(uuid())
  orderId       String
  order         Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  productId     String
  product       Product   @relation(fields: [productId], references: [id])
  variantId     String?
  variant       ProductVariant? @relation(fields: [variantId], references: [id])
  // Zachowujemy bezpośrednie relacje dla kompatybilności wstecznej
  styleId       String?
  style         ProductStyle? @relation(fields: [styleId], references: [id])
  materialId    String?
  material      ProductMaterial? @relation(fields: [materialId], references: [id])
  finishId      String?
  finish        ProductFinish? @relation(fields: [finishId], references: [id])
  quantity      Int       @default(1)
  price         Float
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}
